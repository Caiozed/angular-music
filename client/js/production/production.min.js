var app=angular.module("angularMusic",["ngRoute","ngCookies","ngFileUpload"]);function request($http,method,url,data,success,error){$http({method:method,url:url,data:data}).then(function(response){success(response)},function(response){error(response)})}function redirectTo(path){window.location=path}app.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"../templates/start.html",resolve:{init:function($cookies){$cookies.get("user_id")&&redirectTo("#!menu")}}}).when("/signup",{templateUrl:"../templates/signup.html"}).when("/login",{templateUrl:"../templates/login.html"}).when("/menu",{templateUrl:"../templates/menu.html"})}),app.controller("signupCtrl",function($scope,$rootScope,$cookies,$http){$scope.submitUser=function(username,password,password_confirmation){request($http,"POST","/new/user",{username:username,password:password},function(response){console.log(response),redirectTo("#!login")},function(response){console.log(response)})},$scope.confirmUserData=function(username,password,password_confirmation){username&&password&&password==password_confirmation?$scope.submitUser(username,password,password_confirmation):$scope.messages=["Passwords must match!","Username must have at least 3 characters"]}}),app.controller("loginCtrl",function($scope,$rootScope,$cookies,$http){$scope.login=function(username,password,remember_me){request($http,"POST","/login",{username:username,password:password},function(response){0==response.data.length?$scope.messages=["Wrong username or password"]:(remember_me&&$cookies.put("user_id",response.data[0].id),$scope.isLoggedIn=!0,$rootScope.current_user=response.data[0],redirectTo("#!menu"))},function(response){console.log(response)})}}),app.controller("mainMenuCtrl",function($scope,$rootScope,$cookies,$http,Upload){$scope.getAlbums=function(){request($http,"GET","/albums",{},function(response){0==response.data.length?$scope.messages=["No albums"]:($scope.albums=response.data,console.log(response.data))},function(response){console.log(response)})},$scope.addAlbum=function(name,image){Upload.upload({url:"/new/album",data:{name:name,image:image,artist_id:$rootScope.current_user.id}}).then(function(resp){console.log("Success "+resp)})},$scope.getAlbums()});